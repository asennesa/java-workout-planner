databaseChangeLog:
  - changeSet:
      id: 001-add-soft-delete-columns
      author: workout-planner-team
      comment: Add soft delete support columns (deleted, deleted_at) to all entities for data recovery and audit trail
      changes:
        # Add soft delete columns to users table
        - addColumn:
            tableName: users
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to exercises table
        - addColumn:
            tableName: exercises
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to workout_sessions table
        - addColumn:
            tableName: workout_sessions
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to workout_exercises table
        - addColumn:
            tableName: workout_exercises
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to base_sets table
        - addColumn:
            tableName: base_sets
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to strength_sets table
        - addColumn:
            tableName: strength_sets
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to cardio_sets table
        - addColumn:
            tableName: cardio_sets
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
        
        # Add soft delete columns to flexibility_sets table
        - addColumn:
            tableName: flexibility_sets
            columns:
              - column:
                  name: deleted
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: true
      
      rollback:
        # Rollback statements to remove columns if needed
        - dropColumn:
            tableName: users
            columnName: deleted
        - dropColumn:
            tableName: users
            columnName: deleted_at
        - dropColumn:
            tableName: exercises
            columnName: deleted
        - dropColumn:
            tableName: exercises
            columnName: deleted_at
        - dropColumn:
            tableName: workout_sessions
            columnName: deleted
        - dropColumn:
            tableName: workout_sessions
            columnName: deleted_at
        - dropColumn:
            tableName: workout_exercises
            columnName: deleted
        - dropColumn:
            tableName: workout_exercises
            columnName: deleted_at
        - dropColumn:
            tableName: base_sets
            columnName: deleted
        - dropColumn:
            tableName: base_sets
            columnName: deleted_at
        - dropColumn:
            tableName: strength_sets
            columnName: deleted
        - dropColumn:
            tableName: strength_sets
            columnName: deleted_at
        - dropColumn:
            tableName: cardio_sets
            columnName: deleted
        - dropColumn:
            tableName: cardio_sets
            columnName: deleted_at
        - dropColumn:
            tableName: flexibility_sets
            columnName: deleted
        - dropColumn:
            tableName: flexibility_sets
            columnName: deleted_at

  - changeSet:
      id: 002-add-soft-delete-indexes
      author: workout-planner-team
      comment: Add indexes on deleted column for better query performance on active records
      changes:
        - createIndex:
            indexName: idx_users_deleted
            tableName: users
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_exercises_deleted
            tableName: exercises
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_workout_sessions_deleted
            tableName: workout_sessions
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_workout_exercises_deleted
            tableName: workout_exercises
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_base_sets_deleted
            tableName: base_sets
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_strength_sets_deleted
            tableName: strength_sets
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_cardio_sets_deleted
            tableName: cardio_sets
            columns:
              - column:
                  name: deleted
        
        - createIndex:
            indexName: idx_flexibility_sets_deleted
            tableName: flexibility_sets
            columns:
              - column:
                  name: deleted
      
      rollback:
        - dropIndex:
            indexName: idx_users_deleted
            tableName: users
        - dropIndex:
            indexName: idx_exercises_deleted
            tableName: exercises
        - dropIndex:
            indexName: idx_workout_sessions_deleted
            tableName: workout_sessions
        - dropIndex:
            indexName: idx_workout_exercises_deleted
            tableName: workout_exercises
        - dropIndex:
            indexName: idx_base_sets_deleted
            tableName: base_sets
        - dropIndex:
            indexName: idx_strength_sets_deleted
            tableName: strength_sets
        - dropIndex:
            indexName: idx_cardio_sets_deleted
            tableName: cardio_sets
        - dropIndex:
            indexName: idx_flexibility_sets_deleted
            tableName: flexibility_sets

